<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="ExDoc v0.34.2"/><meta name="project" content="Ecto v3.12.4"/><title>Getting Started — Ecto v3.12.4</title><link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css"/><script src="dist/handlebars.runtime-NWIB6V2M.js"></script><script src="dist/handlebars.templates-K7URE6B4.js"></script><script src="dist/sidebar_items-2FBD157F.js"></script><script src="docs_config.js"></script><script async="async" src="dist/html-YIPIRHGU.js"></script></head><body data-type="extras" class="page-extra sidebar-closed"><script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script><div class="body-wrapper"><nav id="sidebar" class="sidebar"><div class="sidebar-header"><div class="sidebar-projectInfo"><a href="Ecto.html" class="sidebar-projectImage"><img src="assets/logo.png" alt="Ecto"/></a><div><a href="Ecto.html" class="sidebar-projectName" translate="no">
Ecto
        </a><div class="sidebar-projectVersion" translate="no">
          v3.12.4
        </div></div></div><ul id="sidebar-listNav" class="sidebar-listNav" role="tablist"><li></li><li></li><li></li></ul></div><div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button"><ul id="extras-full-list" class="full-list"></ul></div><div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden="hidden"><ul id="modules-full-list" class="full-list"></ul></div><div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden="hidden"><ul id="tasks-full-list" class="full-list"></ul></div></nav><main class="content"><output role="status" id="toast"></output><div id="content" class="content-inner"><div class="top-search"><div class="search-settings"><form class="search-bar" action="search.html"><label class="search-label"><span class="sr-only">Search documentation of Ecto</span><input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/></label></form><div class="autocomplete"></div></div></div><div id="top-content"><h1><a href="https://github.com/elixir-ecto/ecto/blob/v3.12.4/guides/introduction/Getting Started.md#L1" title="View Source" class="icon-action" rel="help"><i class="ri-code-s-slash-line" aria-hidden="true"></i><span class="sr-only">View Source</span></a><span>Getting Started</span></h1><p>This guide is an introduction to <a href="https://github.com/elixir-lang/ecto">Ecto</a>,
the database wrapper and query generator for Elixir. Ecto provides a
standardized API and a set of abstractions for talking to all the different
kinds of databases, so that Elixir developers can query whatever database
they're using by employing similar constructs.</p><p>In this guide, we're going to learn some basics about Ecto, such as creating,
reading, updating and destroying records from a PostgreSQL database. If you want
to see the code from this guide, you can view it <a href="https://github.com/elixir-lang/ecto/tree/master/examples/friends">at ecto/examples/friends on GitHub</a>.</p><p><strong>This guide will require you to have setup PostgreSQL beforehand.</strong></p><h2 id="adding-ecto-to-an-application" class="section-heading"><a href="#adding-ecto-to-an-application" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Adding Ecto to an application</span></h2><p>To start off with, we'll generate a new Elixir application by running this command:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">new</span><span class="w"></span><span class="n">friends</span><span class="w"></span><span class="o">--</span><span class="n">sup</span></code></pre><p>The <code class="inline">--sup</code> option ensures that this application has <a href="https://elixir-lang.org/getting-started/mix-otp/supervisor-and-application.html">a supervision tree</a>, which we'll need for Ecto a little later on.</p><p>To add Ecto to this application, there are a few steps that we need to take. The first step will be adding Ecto and a driver called Postgrex to our <code class="inline">mix.exs</code> file, which we'll do by changing the <code class="inline">deps</code> definition in that file to this:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"></span><span class="nf">deps</span><span class="w"></span><span class="k" data-group-id="3918107890-1">do</span><span class="w"></span><span class="p" data-group-id="3918107890-2">[</span><span class="w"></span><span class="p" data-group-id="3918107890-3">{</span><span class="ss">:ecto_sql</span><span class="p">,</span><span class="w"></span><span class="s">"~> 3.0"</span><span class="p" data-group-id="3918107890-3">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="3918107890-4">{</span><span class="ss">:postgrex</span><span class="p">,</span><span class="w"></span><span class="s">">= 0.0.0"</span><span class="p" data-group-id="3918107890-4">}</span><span class="w"></span><span class="p" data-group-id="3918107890-2">]</span><span class="w"></span><span class="k" data-group-id="3918107890-1">end</span></code></pre><p>Ecto provides the common querying API, but we need the Postgrex driver installed too, as that is what Ecto uses to speak in terms a PostgreSQL database can understand. Ecto talks to its own <code class="inline">Ecto.Adapters.Postgres</code> module, which then in turn talks to the <code class="inline">postgrex</code> package to talk to PostgreSQL.</p><p>To install these dependencies, we will run this command:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">deps</span><span class="o">.</span><span class="n">get</span></code></pre><p>The Postgrex application will receive queries from Ecto and execute them
against our database. If we didn't do this step, we wouldn't be able to do any
querying at all.</p><p>That's the first two steps taken now. We have installed Ecto and Postgrex as
dependencies of our application. We now need to setup some configuration for
Ecto so that we can perform actions on a database from within the
application's code.</p><p>We can set up this configuration by running this command:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">repo</span><span class="w"></span><span class="o">-</span><span class="n">r</span><span class="w"></span><span class="nc">Friends.Repo</span></code></pre><p>This command will generate the configuration required to connect to a database. The first bit of configuration is in <code class="inline">config/config.exs</code>:</p><pre><code class="makeup elixir" translate="no"><span class="n">config</span><span class="w"></span><span class="ss">:friends</span><span class="p">,</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="p">,</span><span class="w"></span><span class="ss">database</span><span class="p">:</span><span class="w"></span><span class="s">"friends"</span><span class="p">,</span><span class="w"></span><span class="ss">username</span><span class="p">:</span><span class="w"></span><span class="s">"user"</span><span class="p">,</span><span class="w"></span><span class="ss">password</span><span class="p">:</span><span class="w"></span><span class="s">"pass"</span><span class="p">,</span><span class="w"></span><span class="ss">hostname</span><span class="p">:</span><span class="w"></span><span class="s">"localhost"</span></code></pre><p><strong>NOTE</strong>: Your PostgreSQL database may be setup to</p><ul><li>not require a username and password. If the above configuration doesn't work, try removing the username and password fields, or setting them both to "postgres".</li><li>be running on a non-standard port. The default port is <code class="inline">5432</code>. You can specify your specific port by adding it to the config: e.g. <code class="inline">port: 15432</code>.</li></ul><p>This configures how Ecto will connect to our database, called "friends". Specifically, it configures a "repo". More information about <a href="https://hexdocs.pm/ecto/Ecto.Repo.html">Ecto.Repo can be found in its documentation</a>.</p><p>The <code class="inline">Friends.Repo</code> module is defined in <code class="inline">lib/friends/repo.ex</code> by our <a href="Mix.Tasks.Ecto.Gen.Repo.html"><code class="inline">mix ecto.gen.repo</code></a> command:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="w"></span><span class="k" data-group-id="6079491702-1">do</span><span class="w"></span><span class="kn">use</span><span class="w"></span><span class="nc">Ecto.Repo</span><span class="p">,</span><span class="w"></span><span class="ss">otp_app</span><span class="p">:</span><span class="w"></span><span class="ss">:friends</span><span class="p">,</span><span class="w"></span><span class="ss">adapter</span><span class="p">:</span><span class="w"></span><span class="nc">Ecto.Adapters.Postgres</span><span class="w"></span><span class="k" data-group-id="6079491702-1">end</span></code></pre><p>This module is what we'll be using to query our database shortly. It uses the <a href="Ecto.Repo.html"><code class="inline">Ecto.Repo</code></a> module, and the <code class="inline">otp_app</code> tells Ecto which Elixir application it can look for database configuration in. In this case, we've specified that it is the <code class="inline">:friends</code> application where Ecto can find that configuration and so Ecto will use the configuration that was set up in <code class="inline">config/config.exs</code>. Finally, we configure the database <code class="inline">:adapter</code> to Postgres.</p><p>Finally, the <code class="inline">Friends.Repo</code> must be started within the application's supervision tree, which we can do in <code class="inline">lib/friends/application.ex</code>, inside the <code class="inline">start/2</code> function:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"></span><span class="nf">start</span><span class="p" data-group-id="7045098061-1">(</span><span class="c">_type</span><span class="p">,</span><span class="w"></span><span class="c">_args</span><span class="p" data-group-id="7045098061-1">)</span><span class="w"></span><span class="k" data-group-id="7045098061-2">do</span><span class="w"></span><span class="n">children</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="7045098061-3">[</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="7045098061-3">]</span><span class="w"></span><span class="n">...</span></code></pre><p>This piece of configuration will start the Ecto process which receives and executes our application's queries. Without it, we wouldn't be able to query the database at all!</p><p>There's one final bit of configuration that we'll need to add ourselves, since the generator does not add it. Underneath the configuration in <code class="inline">config/config.exs</code>, add this line:</p><pre><code class="makeup elixir" translate="no"><span class="n">config</span><span class="w"></span><span class="ss">:friends</span><span class="p">,</span><span class="w"></span><span class="ss">ecto_repos</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="7720910386-1">[</span><span class="nc">Friends.Repo</span><span class="p" data-group-id="7720910386-1">]</span></code></pre><p>This tells our application about the repo, which will allow us to run commands such as <a href="Mix.Tasks.Ecto.Create.html"><code class="inline">mix ecto.create</code></a> very soon.</p><p>We've now configured our application so that it's able to make queries to our database. Let's now create our database, add a table to it, and then perform some queries.</p><h2 id="setting-up-the-database" class="section-heading"><a href="#setting-up-the-database" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Setting up the database</span></h2><p>To be able to query a database, it first needs to exist. We can create the database with this command:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">create</span></code></pre><p>If the database has been created successfully, then you will see this message:</p><pre><code class="makeup elixir" translate="no"><span class="nc">The</span><span class="w"></span><span class="n">database</span><span class="w"></span><span class="k">for</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="w"></span><span class="n">has</span><span class="w"></span><span class="n">been</span><span class="w"></span><span class="n">created</span><span class="o">.</span></code></pre><p><strong>NOTE:</strong> If you get an error, you should try changing your configuration in <code class="inline">config/config.exs</code>, as it may be an authentication error.</p><p>A database by itself isn't very queryable, so we will need to create a table within that database. To do that, we'll use what's referred to as a <em>migration</em>. If you've come from Active Record (or similar), you will have seen these before. A migration is a single step in the process of constructing your database.</p><p>Let's create a migration now with this command:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">migration</span><span class="w"></span><span class="n">create_people</span></code></pre><p>This command will generate a brand new migration file in <code class="inline">priv/repo/migrations</code>, which is empty by default:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"></span><span class="nc">Friends.Repo.Migrations.CreatePeople</span><span class="w"></span><span class="k" data-group-id="6492263463-1">do</span><span class="w"></span><span class="kn">use</span><span class="w"></span><span class="nc">Ecto.Migration</span><span class="w"></span><span class="kd">def</span><span class="w"></span><span class="nf">change</span><span class="w"></span><span class="k" data-group-id="6492263463-2">do</span><span class="w"></span><span class="k" data-group-id="6492263463-2">end</span><span class="w"></span><span class="k" data-group-id="6492263463-1">end</span></code></pre><p>Let's add some code to this migration to create a new table called "people", with a few columns in it:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"></span><span class="nc">Friends.Repo.Migrations.CreatePeople</span><span class="w"></span><span class="k" data-group-id="8154678195-1">do</span><span class="w"></span><span class="kn">use</span><span class="w"></span><span class="nc">Ecto.Migration</span><span class="w"></span><span class="kd">def</span><span class="w"></span><span class="nf">change</span><span class="w"></span><span class="k" data-group-id="8154678195-2">do</span><span class="w"></span><span class="n">create</span><span class="w"></span><span class="n">table</span><span class="p" data-group-id="8154678195-3">(</span><span class="ss">:people</span><span class="p" data-group-id="8154678195-3">)</span><span class="w"></span><span class="k" data-group-id="8154678195-4">do</span><span class="w"></span><span class="n">add</span><span class="w"></span><span class="ss">:first_name</span><span class="p">,</span><span class="w"></span><span class="ss">:string</span><span class="w"></span><span class="n">add</span><span class="w"></span><span class="ss">:last_name</span><span class="p">,</span><span class="w"></span><span class="ss">:string</span><span class="w"></span><span class="n">add</span><span class="w"></span><span class="ss">:age</span><span class="p">,</span><span class="w"></span><span class="ss">:integer</span><span class="w"></span><span class="k" data-group-id="8154678195-4">end</span><span class="w"></span><span class="k" data-group-id="8154678195-2">end</span><span class="w"></span><span class="k" data-group-id="8154678195-1">end</span></code></pre><p>This new code will tell Ecto to create a new table called <code class="inline">people</code>, and add three new fields: <code class="inline">first_name</code>, <code class="inline">last_name</code> and <code class="inline">age</code> to that table. The types of these fields are <code class="inline">string</code> and <code class="inline">integer</code>. (The different types that Ecto supports are covered in the <a href="https://hexdocs.pm/ecto/Ecto.Schema.html">Ecto.Schema</a> documentation.)</p><p><strong>NOTE</strong>: The naming convention for tables in Ecto databases is to use a pluralized name.</p><p>To run this migration and create the <code class="inline">people</code> table in our database, we will run this command:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">migrate</span></code></pre><p>If we found out that we made a mistake in this migration, we could run <code class="inline">mix ecto.rollback</code> to undo the changes in the migration. We could then fix the changes in the migration and run <code class="inline">mix ecto.migrate</code> again. If we ran <code class="inline">mix ecto.rollback</code> now, it would delete the table that we just created.</p><p>We now have a table created in our database. The next step that we'll need to do is to create the schema.</p><h2 id="creating-the-schema" class="section-heading"><a href="#creating-the-schema" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Creating the schema</span></h2><p>The schema is an Elixir representation of data from our database. Schemas are commonly associated with a database table, however they can be associated with a database view as well.</p><p>Let's create the schema within our application at <code class="inline">lib/friends/person.ex</code>:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="k" data-group-id="6059405468-1">do</span><span class="w"></span><span class="kn">use</span><span class="w"></span><span class="nc">Ecto.Schema</span><span class="w"></span><span class="n">schema</span><span class="w"></span><span class="s">"people"</span><span class="w"></span><span class="k" data-group-id="6059405468-2">do</span><span class="w"></span><span class="n">field</span><span class="w"></span><span class="ss">:first_name</span><span class="p">,</span><span class="w"></span><span class="ss">:string</span><span class="w"></span><span class="n">field</span><span class="w"></span><span class="ss">:last_name</span><span class="p">,</span><span class="w"></span><span class="ss">:string</span><span class="w"></span><span class="n">field</span><span class="w"></span><span class="ss">:age</span><span class="p">,</span><span class="w"></span><span class="ss">:integer</span><span class="w"></span><span class="k" data-group-id="6059405468-2">end</span><span class="w"></span><span class="k" data-group-id="6059405468-1">end</span></code></pre><p>This defines the schema from the database that this schema maps to. In this case, we're telling Ecto that the <code class="inline">Friends.Person</code> schema maps to the <code class="inline">people</code> table in the database, and the <code class="inline">first_name</code>, <code class="inline">last_name</code> and <code class="inline">age</code> fields in that table. The second argument passed to <code class="inline">field</code> tells Ecto how we want the information from the database to be represented in our schema.</p><p>We've called this schema <code class="inline">Person</code> because the naming convention in Ecto for schemas is a singularized name.</p><p>We can play around with this schema in an IEx session by starting one up with <code class="inline">iex -S mix</code> and then running this code in it:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="6748974864-1">%</span><span class="nc" data-group-id="6748974864-1">Friends.Person</span><span class="p" data-group-id="6748974864-1">{</span><span class="p" data-group-id="6748974864-1">}</span></code></pre><p>This code will give us a new <code class="inline">Friends.Person</code> struct, which will have <code class="inline">nil</code> values for all the fields. We can set values on these fields by generating a new struct:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="6454921940-1">%</span><span class="nc" data-group-id="6454921940-1">Friends.Person</span><span class="p" data-group-id="6454921940-1">{</span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">28</span><span class="p" data-group-id="6454921940-1">}</span></code></pre><p>Or with syntax like this:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="8194729115-1">%{</span><span class="n">person</span><span class="w"></span><span class="o">|</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">28</span><span class="p" data-group-id="8194729115-1">}</span></code></pre><p>We can retrieve values using this syntax:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="o">.</span><span class="n">age</span><span class="w"></span><span class="c1"># => 28</span></code></pre><p>Let's take a look at how we can insert data into the database.</p><h2 id="inserting-data" class="section-heading"><a href="#inserting-data" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Inserting data</span></h2><p>We can insert a new record into our <code class="inline">people</code> table with this code:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="9227093129-1">%</span><span class="nc" data-group-id="9227093129-1">Friends.Person</span><span class="p" data-group-id="9227093129-1">{</span><span class="p" data-group-id="9227093129-1">}</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="9227093129-2">(</span><span class="n">person</span><span class="p" data-group-id="9227093129-2">)</span></code></pre><p>To insert the data into our database, we call <code class="inline">insert</code> on <code class="inline">Friends.Repo</code>, which is the module that uses Ecto to talk to our database. This function tells Ecto that we want to insert a new <code class="inline">Friends.Person</code> record into the database corresponding with <code class="inline">Friends.Repo</code>. The <code class="inline">person</code> struct here represents the data that we want to insert into the database.</p><p>A successful insertion will return a tuple, like so:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="7196241567-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="7196241567-2">%</span><span class="nc" data-group-id="7196241567-2">Friends.Person</span><span class="p" data-group-id="7196241567-2">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="7196241567-3">#</span><span class="nc" data-group-id="7196241567-3">Ecto.Schema.Metadata</span><span class="p" data-group-id="7196241567-3"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="7196241567-3">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="no">nil</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="no">nil</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="no">nil</span><span class="p" data-group-id="7196241567-2">}</span><span class="p" data-group-id="7196241567-1">}</span></code></pre><p>The <code class="inline">:ok</code> atom can be used for pattern matching purposes to ensure that the insertion succeeds. A situation where the insertion may not succeed is if you have a constraint on the database itself. For instance, if the database had a unique constraint on a field called <code class="inline">email</code> so that an email can only be used for one person record, then the insertion would fail.</p><p>You may wish to pattern match on the tuple in order to refer to the record inserted into the database:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="6230237378-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"></span><span class="n">person</span><span class="p" data-group-id="6230237378-1">}</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="w"></span><span class="n">person</span></code></pre><h2 id="validating-changes" class="section-heading"><a href="#validating-changes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Validating changes</span></h2><p>In Ecto, you may wish to validate changes before they go to the database. For instance, you may wish that a person has both a first name and a last name before a record can be entered into the database. For this, Ecto has <a href="https://hexdocs.pm/ecto/Ecto.Changeset.html"><em>changesets</em></a>.</p><p>Let's add a changeset to our <code class="inline">Friends.Person</code> module inside <code class="inline">lib/friends/person.ex</code> now:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"></span><span class="nf">changeset</span><span class="p" data-group-id="4748864574-1">(</span><span class="n">person</span><span class="p">,</span><span class="w"></span><span class="n">params</span><span class="w"></span><span class="o">\\</span><span class="w"></span><span class="p" data-group-id="4748864574-2">%{</span><span class="p" data-group-id="4748864574-2">}</span><span class="p" data-group-id="4748864574-1">)</span><span class="w"></span><span class="k" data-group-id="4748864574-3">do</span><span class="w"></span><span class="n">person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">cast</span><span class="p" data-group-id="4748864574-4">(</span><span class="n">params</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4748864574-5">[</span><span class="ss">:first_name</span><span class="p">,</span><span class="w"></span><span class="ss">:last_name</span><span class="p">,</span><span class="w"></span><span class="ss">:age</span><span class="p" data-group-id="4748864574-5">]</span><span class="p" data-group-id="4748864574-4">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Changeset</span><span class="o">.</span><span class="n">validate_required</span><span class="p" data-group-id="4748864574-6">(</span><span class="p" data-group-id="4748864574-7">[</span><span class="ss">:first_name</span><span class="p">,</span><span class="w"></span><span class="ss">:last_name</span><span class="p" data-group-id="4748864574-7">]</span><span class="p" data-group-id="4748864574-6">)</span><span class="w"></span><span class="k" data-group-id="4748864574-3">end</span></code></pre><p>This changeset takes a <code class="inline">person</code> and a set of params, which are to be the changes to apply to this person. The <code class="inline">changeset</code> function first casts the <code class="inline">first_name</code>, <code class="inline">last_name</code> and <code class="inline">age</code> keys from the parameters passed in to the changeset. Casting tells the changeset what parameters are allowed to be passed through in this changeset, and anything not in the list will be ignored.</p><p>On the next line, we call <code class="inline">validate_required</code> which says that, for this changeset, we expect <code class="inline">first_name</code> and <code class="inline">last_name</code> to have values specified. Let's use this changeset to attempt to create a new record without a <code class="inline">first_name</code> and <code class="inline">last_name</code>:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="1893240246-1">%</span><span class="nc" data-group-id="1893240246-1">Friends.Person</span><span class="p" data-group-id="1893240246-1">{</span><span class="p" data-group-id="1893240246-1">}</span><span class="w"></span><span class="n">changeset</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="1893240246-2">(</span><span class="n">person</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="1893240246-3">%{</span><span class="p" data-group-id="1893240246-3">}</span><span class="p" data-group-id="1893240246-2">)</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="1893240246-4">(</span><span class="n">changeset</span><span class="p" data-group-id="1893240246-4">)</span></code></pre><p>On the first line here, we get a struct from the <code class="inline">Friends.Person</code> module. We know what that does, because we saw it not too long ago. On the second line we do something brand new: we define a changeset. This changeset says that on the specified <code class="inline">person</code> object, we're looking to make some changes. In this case, we're not looking to change anything at all.</p><p>On the final line, rather than inserting the <code class="inline">person</code>, we insert the <code class="inline">changeset</code>. The <code class="inline">changeset</code> knows about the <code class="inline">person</code>, the changes and the validation rules that must be met before the data can be entered into the database. When this third line runs, we'll see this:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="4859496631-1">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4859496631-2">#</span><span class="nc" data-group-id="4859496631-2">Ecto.Changeset</span><span class="p" data-group-id="4859496631-2"><</span><span class="ss">action</span><span class="p">:</span><span class="w"></span><span class="ss">:insert</span><span class="p">,</span><span class="w"></span><span class="ss">changes</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4859496631-3">%{</span><span class="p" data-group-id="4859496631-3">}</span><span class="p">,</span><span class="w"></span><span class="ss">errors</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4859496631-4">[</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"can't be blank"</span><span class="p" data-group-id="4859496631-4">]</span><span class="p">,</span><span class="w"></span><span class="ss">data</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4859496631-5">#</span><span class="nc" data-group-id="4859496631-5">Friends.Person</span><span class="p" data-group-id="4859496631-5"><</span><span class="p" data-group-id="4859496631-5">></span><span class="p">,</span><span class="w"></span><span class="ss">valid?</span><span class="p">:</span><span class="w"></span><span class="no">false</span><span class="p" data-group-id="4859496631-2">></span><span class="p" data-group-id="4859496631-1">}</span></code></pre><p>Just like the last time we did an insertion, this returns a tuple. This time however, the first element in the tuple is <code class="inline">:error</code>, which indicates something bad happened. The specifics of what happened are included in the changeset which is returned. We can access these by doing some pattern matching:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="4510498352-1">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"></span><span class="n">changeset</span><span class="p" data-group-id="4510498352-1">}</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="4510498352-2">(</span><span class="n">changeset</span><span class="p" data-group-id="4510498352-2">)</span></code></pre><p>Then we can get to the errors by doing <code class="inline">changeset.errors</code>:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="5271633803-1">[</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="5271633803-2">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="5271633803-3">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="5271633803-3">]</span><span class="p" data-group-id="5271633803-2">}</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="5271633803-4">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="5271633803-5">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="5271633803-5">]</span><span class="p" data-group-id="5271633803-4">}</span><span class="p" data-group-id="5271633803-1">]</span></code></pre><p>And we can ask the changeset itself if it is valid, even before doing an insertion:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w"></span><span class="c1">#=> false</span></code></pre><p>Since this changeset has errors, no new record was inserted into the <code class="inline">people</code>
table.</p><p>Let's try now with some valid data.</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="5758905197-1">%</span><span class="nc" data-group-id="5758905197-1">Friends.Person</span><span class="p" data-group-id="5758905197-1">{</span><span class="p" data-group-id="5758905197-1">}</span><span class="w"></span><span class="n">changeset</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="5758905197-2">(</span><span class="n">person</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="5758905197-3">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p" data-group-id="5758905197-3">}</span><span class="p" data-group-id="5758905197-2">)</span></code></pre><p>We start out here with a normal <code class="inline">Friends.Person</code> struct. We then create a changeset for that <code class="inline">person</code> which has a <code class="inline">first_name</code> and a <code class="inline">last_name</code> parameter specified. At this point, we can ask the changeset if it has errors:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="o">.</span><span class="n">errors</span><span class="w"></span><span class="c1">#=> []</span></code></pre><p>And we can ask if it's valid or not:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w"></span><span class="c1">#=> true</span></code></pre><p>The changeset does not have errors, and is valid. Therefore if we try to insert this changeset it will work:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="4864914229-1">(</span><span class="n">changeset</span><span class="p" data-group-id="4864914229-1">)</span><span class="w"></span><span class="c1">#=> {:ok,</span><span class="w"></span><span class="p" data-group-id="4864914229-2">%</span><span class="nc" data-group-id="4864914229-2">Friends.Person</span><span class="p" data-group-id="4864914229-2">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4864914229-3">#</span><span class="nc" data-group-id="4864914229-3">Ecto.Schema.Metadata</span><span class="p" data-group-id="4864914229-3"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="4864914229-3">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="no">nil</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">3</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p" data-group-id="4864914229-2">}</span><span class="err">}</span></code></pre><p>Due to <code class="inline">Friends.Repo.insert</code> returning a tuple, we can use a <code class="inline">case</code> to determine different code paths depending on what happens:</p><pre><code class="makeup elixir" translate="no"><span class="k">case</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="1448009534-1">(</span><span class="n">changeset</span><span class="p" data-group-id="1448009534-1">)</span><span class="w"></span><span class="k" data-group-id="1448009534-2">do</span><span class="w"></span><span class="p" data-group-id="1448009534-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"></span><span class="n">person</span><span class="p" data-group-id="1448009534-3">}</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="c1"># do something with person</span><span class="w"></span><span class="p" data-group-id="1448009534-4">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"></span><span class="n">changeset</span><span class="p" data-group-id="1448009534-4">}</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="c1"># do something with changeset</span><span class="w"></span><span class="k" data-group-id="1448009534-2">end</span></code></pre><p><strong>NOTE:</strong><code class="inline">changeset.valid?</code> will not check constraints (such as <code class="inline">uniqueness_constraint</code>). For that, you will need to attempt to do an insertion and check for errors from the database. It's for this reason it's best practice to try inserting data and validate the returned tuple from <code class="inline">Friends.Repo.insert</code> to get the correct errors, as prior to insertion the changeset will only contain validation errors from the application itself.</p><p>If the insertion of the changeset succeeds, then you can do whatever you wish with the <code class="inline">person</code> returned in that result. If it fails, then you have access to the changeset and its errors. In the failure case, you may wish to present these errors to the end user. The errors in the changeset are a keyword list that looks like this:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="2835302951-1">[</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="2835302951-2">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="2835302951-3">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="2835302951-3">]</span><span class="p" data-group-id="2835302951-2">}</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="2835302951-4">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="2835302951-5">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="2835302951-5">]</span><span class="p" data-group-id="2835302951-4">}</span><span class="p" data-group-id="2835302951-1">]</span></code></pre><p>The first element of the tuple is the validation message, and the second element is a keyword list of options for the validation message. Imagine that we had a field called <code class="inline">bio</code> that we were validating, and that field has to be longer than 15 characters. This is what would be returned:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="8742336414-1">[</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="8742336414-2">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="8742336414-3">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="8742336414-3">]</span><span class="p" data-group-id="8742336414-2">}</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="8742336414-4">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="8742336414-5">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="8742336414-5">]</span><span class="p" data-group-id="8742336414-4">}</span><span class="p">,</span><span class="w"></span><span class="ss">bio</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="8742336414-6">{</span><span class="s">"should be at least %{count} character(s)"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="8742336414-7">[</span><span class="ss">count</span><span class="p">:</span><span class="w"></span><span class="mi">15</span><span class="p">,</span><span class="w"></span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:length</span><span class="p">,</span><span class="w"></span><span class="ss">kind</span><span class="p">:</span><span class="w"></span><span class="ss">:min</span><span class="p">,</span><span class="w"></span><span class="ss">type</span><span class="p">:</span><span class="w"></span><span class="ss">:string</span><span class="p" data-group-id="8742336414-7">]</span><span class="p" data-group-id="8742336414-6">}</span><span class="p" data-group-id="8742336414-1">]</span></code></pre><p>To display these error messages in a human friendly way, we can use <a href="Ecto.Changeset.html#traverse_errors/2"><code class="inline">Ecto.Changeset.traverse_errors/2</code></a>:</p><pre><code class="makeup elixir" translate="no"><span class="n">traverse_errors</span><span class="p" data-group-id="9683654584-1">(</span><span class="n">changeset</span><span class="p">,</span><span class="w"></span><span class="k" data-group-id="9683654584-2">fn</span><span class="w"></span><span class="p" data-group-id="9683654584-3">{</span><span class="n">msg</span><span class="p">,</span><span class="w"></span><span class="n">opts</span><span class="p" data-group-id="9683654584-3">}</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="9683654584-4">(</span><span class="n">opts</span><span class="p">,</span><span class="w"></span><span class="n">msg</span><span class="p">,</span><span class="w"></span><span class="k" data-group-id="9683654584-5">fn</span><span class="w"></span><span class="p" data-group-id="9683654584-6">{</span><span class="n">key</span><span class="p">,</span><span class="w"></span><span class="n">value</span><span class="p" data-group-id="9683654584-6">}</span><span class="p">,</span><span class="w"></span><span class="n">acc</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="nc">String</span><span class="o">.</span><span class="n">replace</span><span class="p" data-group-id="9683654584-7">(</span><span class="n">acc</span><span class="p">,</span><span class="w"></span><span class="s">"%{</span><span class="si" data-group-id="9683654584-8">#{</span><span class="n">key</span><span class="si" data-group-id="9683654584-8">}</span><span class="s">}"</span><span class="p">,</span><span class="w"></span><span class="n">to_string</span><span class="p" data-group-id="9683654584-9">(</span><span class="n">value</span><span class="p" data-group-id="9683654584-9">)</span><span class="p" data-group-id="9683654584-7">)</span><span class="w"></span><span class="k" data-group-id="9683654584-5">end</span><span class="p" data-group-id="9683654584-4">)</span><span class="w"></span><span class="k" data-group-id="9683654584-2">end</span><span class="p" data-group-id="9683654584-1">)</span></code></pre><p>This will return the following for the errors shown above:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="2525446544-1">%{</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="2525446544-2">[</span><span class="s">"can't be blank"</span><span class="p" data-group-id="2525446544-2">]</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="2525446544-3">[</span><span class="s">"can't be blank"</span><span class="p" data-group-id="2525446544-3">]</span><span class="p">,</span><span class="w"></span><span class="ss">bio</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="2525446544-4">[</span><span class="s">"should be at least 15 character(s)"</span><span class="p" data-group-id="2525446544-4">]</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="2525446544-1">}</span></code></pre><p>One more final thing to mention here: you can trigger an exception to be thrown by using <code class="inline">Friends.Repo.insert!/2</code>. If a changeset is invalid, you will see an <a href="Ecto.InvalidChangesetError.html"><code class="inline">Ecto.InvalidChangesetError</code></a> exception. Here's a quick example of that:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert!</span><span class="w"></span><span class="nc">Friends.Person</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="0943833110-1">(</span><span class="p" data-group-id="0943833110-2">%</span><span class="nc" data-group-id="0943833110-2">Friends.Person</span><span class="p" data-group-id="0943833110-2">{</span><span class="p" data-group-id="0943833110-2">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="0943833110-3">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p" data-group-id="0943833110-3">}</span><span class="p" data-group-id="0943833110-1">)</span><span class="w"></span><span class="gt">** (Ecto.InvalidChangesetError) could not perform insert because changeset is invalid.</span><span class="w"></span><span class="nc">Errors</span><span class="w"></span><span class="p" data-group-id="0943833110-4">%{</span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="0943833110-5">[</span><span class="p" data-group-id="0943833110-6">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="0943833110-7">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="0943833110-7">]</span><span class="p" data-group-id="0943833110-6">}</span><span class="p" data-group-id="0943833110-5">]</span><span class="p" data-group-id="0943833110-4">}</span><span class="w"></span><span class="nc">Applied</span><span class="w"></span><span class="n">changes</span><span class="w"></span><span class="p" data-group-id="0943833110-8">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p" data-group-id="0943833110-8">}</span><span class="w"></span><span class="nc">Params</span><span class="w"></span><span class="p" data-group-id="0943833110-9">%{</span><span class="s">"first_name"</span><span class="w"></span><span class="p">=></span><span class="w"></span><span class="s">"Ryan"</span><span class="p" data-group-id="0943833110-9">}</span><span class="w"></span><span class="nc">Changeset</span><span class="w"></span><span class="p" data-group-id="0943833110-10">#</span><span class="nc" data-group-id="0943833110-10">Ecto.Changeset</span><span class="p" data-group-id="0943833110-10"><</span><span class="w"></span><span class="ss">action</span><span class="p">:</span><span class="w"></span><span class="ss">:insert</span><span class="p">,</span><span class="w"></span><span class="ss">changes</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="0943833110-11">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p" data-group-id="0943833110-11">}</span><span class="p">,</span><span class="w"></span><span class="ss">errors</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="0943833110-12">[</span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="0943833110-13">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="0943833110-14">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="0943833110-14">]</span><span class="p" data-group-id="0943833110-13">}</span><span class="p" data-group-id="0943833110-12">]</span><span class="p">,</span><span class="w"></span><span class="ss">data</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="0943833110-15">#</span><span class="nc" data-group-id="0943833110-15">Friends.Person</span><span class="p" data-group-id="0943833110-15"><</span><span class="p" data-group-id="0943833110-15">></span><span class="p">,</span><span class="w"></span><span class="ss">valid?</span><span class="p">:</span><span class="w"></span><span class="no">false</span><span class="w"></span><span class="p" data-group-id="0943833110-10">></span><span class="w"></span><span class="p" data-group-id="0943833110-16">(</span><span class="n">ecto</span><span class="p" data-group-id="0943833110-16">)</span><span class="w"></span><span class="n">lib</span><span class="o">/</span><span class="n">ecto</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">ex</span><span class="p">:</span><span class="mi">257</span><span class="p">:</span><span class="w"></span><span class="nc">Ecto.Repo.Schema</span><span class="o">.</span><span class="n">insert!</span><span class="o">/</span><span class="mi">4</span></code></pre><p>This exception shows us the changes from the changeset, and how the changeset is invalid. This can be useful if you want to insert a bunch of data and then have an exception raised if that data is not inserted correctly at all.</p><p>Now that we've covered inserting data into the database, let's look at how we can pull that data back out.</p><h2 id="our-first-queries" class="section-heading"><a href="#our-first-queries" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Our first queries</span></h2><p>Querying a database requires two steps in Ecto. First, we must construct the query and then we must execute that query against the database by passing the query to the repository. Before we do this, let's re-create the database for our app and setup some test data. To re-create the database, we'll run these commands:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">drop</span><span class="w"></span><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">create</span><span class="w"></span><span class="n">mix</span><span class="w"></span><span class="n">ecto</span><span class="o">.</span><span class="n">migrate</span></code></pre><p>Then to create the test data, we'll run this in an <code class="inline">iex -S mix</code> session:</p><pre><code class="makeup elixir" translate="no"><span class="n">people</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="p" data-group-id="4915671639-1">[</span><span class="w"></span><span class="p" data-group-id="4915671639-2">%</span><span class="nc" data-group-id="4915671639-2">Friends.Person</span><span class="p" data-group-id="4915671639-2">{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">28</span><span class="p" data-group-id="4915671639-2">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4915671639-3">%</span><span class="nc" data-group-id="4915671639-3">Friends.Person</span><span class="p" data-group-id="4915671639-3">{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"John"</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">27</span><span class="p" data-group-id="4915671639-3">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4915671639-4">%</span><span class="nc" data-group-id="4915671639-4">Friends.Person</span><span class="p" data-group-id="4915671639-4">{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Jane"</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">26</span><span class="p" data-group-id="4915671639-4">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4915671639-1">]</span><span class="w"></span><span class="nc">Enum</span><span class="o">.</span><span class="n">each</span><span class="p" data-group-id="4915671639-5">(</span><span class="n">people</span><span class="p">,</span><span class="w"></span><span class="k" data-group-id="4915671639-6">fn</span><span class="w"></span><span class="p" data-group-id="4915671639-7">(</span><span class="n">person</span><span class="p" data-group-id="4915671639-7">)</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">insert</span><span class="p" data-group-id="4915671639-8">(</span><span class="n">person</span><span class="p" data-group-id="4915671639-8">)</span><span class="w"></span><span class="k" data-group-id="4915671639-6">end</span><span class="p" data-group-id="4915671639-5">)</span></code></pre><p>This code will create three new people in our database, Ryan, John and Jane. Note here that we could've used a changeset to validate the data going into the database, but the choice was made not to use one.</p><p>We'll be querying for these people in this section. Let's jump in!</p><h3 id="fetching-a-single-record" class="section-heading"><a href="#fetching-a-single-record" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fetching a single record</span></h3><p>Let's start off with fetching just one record from our <code class="inline">people</code> table:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">first</span></code></pre><p>That code will generate an <a href="Ecto.Query.html"><code class="inline">Ecto.Query</code></a>, which will be this:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="1660862089-1">#</span><span class="nc" data-group-id="1660862089-1">Ecto.Query</span><span class="p" data-group-id="1660862089-1"><</span><span class="n">from</span><span class="w"></span><span class="n">p0</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">order_by</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="1660862089-2">[</span><span class="ss">asc</span><span class="p">:</span><span class="w"></span><span class="n">p0</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1660862089-2">]</span><span class="p">,</span><span class="w"></span><span class="ss">limit</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p" data-group-id="1660862089-1">></span></code></pre><p>The code between the angle brackets <code class="inline"><...></code> here shows the Ecto query which has been constructed. We could construct this query ourselves with almost exactly the same syntax:</p><pre><code class="makeup elixir" translate="no"><span class="kn">require</span><span class="w"></span><span class="nc">Ecto.Query</span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">from</span><span class="w"></span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">order_by</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="1510850885-1">[</span><span class="ss">asc</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1510850885-1">]</span><span class="p">,</span><span class="w"></span><span class="ss">limit</span><span class="p">:</span><span class="w"></span><span class="mi">1</span></code></pre><p>We need to <code class="inline">require Ecto.Query</code> here to enable the macros from that module. Then it's a matter of calling the <code class="inline">from</code> function from <a href="Ecto.Query.html"><code class="inline">Ecto.Query</code></a> and passing in the code from between the angle brackets. As we can see here, <code class="inline">Ecto.Query.first</code> saves us from having to specify the <code class="inline">order</code> and <code class="inline">limit</code> for the query.</p><p>To execute the query that we've just constructed, we can call <code class="inline">Friends.Repo.one</code>:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">first</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">one</span></code></pre><p>The <code class="inline">one</code> function retrieves just one record from our database and returns a new struct from the <code class="inline">Friends.Person</code> module:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="3735550919-1">%</span><span class="nc" data-group-id="3735550919-1">Friends.Person</span><span class="p" data-group-id="3735550919-1">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="3735550919-2">#</span><span class="nc" data-group-id="3735550919-2">Ecto.Schema.Metadata</span><span class="p" data-group-id="3735550919-2"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="3735550919-2">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">28</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p" data-group-id="3735550919-1">}</span></code></pre><p>Similar to <code class="inline">first</code>, there is also <code class="inline">last</code>:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">last</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">one</span><span class="w"></span><span class="c1">#=> %Friends.Person{__meta__: #Ecto.Schema.Metadata<:loaded, "people">, age: 26,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Jane"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">3</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="err">}</span></code></pre><p>The <code class="inline">Ecto.Repo.one</code> function will only return a struct if there is one record in the
result from the database. If there is more than one record returned, an
<a href="Ecto.MultipleResultsError.html"><code class="inline">Ecto.MultipleResultsError</code></a> exception will be thrown. Some code that would
cause that issue to happen is:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">one</span></code></pre><p>We've left out the <code class="inline">Ecto.Query.first</code> here, and so there is no <code class="inline">limit</code> or <code class="inline">order</code> clause applied to the executed query. We'll see the executed query in the debug log:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="8167608395-1">[</span><span class="n">timestamp</span><span class="p" data-group-id="8167608395-1">]</span><span class="w"></span><span class="p" data-group-id="8167608395-2">[</span><span class="n">debug</span><span class="p" data-group-id="8167608395-2">]</span><span class="w"></span><span class="nc">SELECT</span><span class="w"></span><span class="n">p0</span><span class="o">.</span><span class="s">"id"</span><span class="p">,</span><span class="w"></span><span class="n">p0</span><span class="o">.</span><span class="s">"first_name"</span><span class="p">,</span><span class="w"></span><span class="n">p0</span><span class="o">.</span><span class="s">"last_name"</span><span class="p">,</span><span class="w"></span><span class="n">p0</span><span class="o">.</span><span class="s">"age"</span><span class="w"></span><span class="nc">FROM</span><span class="w"></span><span class="s">"people"</span><span class="w"></span><span class="nc">AS</span><span class="w"></span><span class="n">p0</span><span class="w"></span><span class="p" data-group-id="8167608395-3">[</span><span class="p" data-group-id="8167608395-3">]</span><span class="w"></span><span class="nc">OK</span><span class="w"></span><span class="n">query</span><span class="o">=</span><span class="mf">1.8</span><span class="n">ms</span></code></pre><p>Then immediately after that, we will see the <a href="Ecto.MultipleResultsError.html"><code class="inline">Ecto.MultipleResultsError</code></a> exception:</p><pre><code class="makeup elixir" translate="no"><span class="gt">** (Ecto.MultipleResultsError) expected at most one result but got 3 in query:</span><span class="w"></span><span class="n">from</span><span class="w"></span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="n">lib</span><span class="o">/</span><span class="n">ecto</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">queryable</span><span class="o">.</span><span class="n">ex</span><span class="p">:</span><span class="mi">67</span><span class="p">:</span><span class="w"></span><span class="nc">Ecto.Repo.Queryable</span><span class="o">.</span><span class="n">one</span><span class="o">/</span><span class="mi">4</span></code></pre><p>This happens because Ecto doesn't know what one record out of all the records
returned that we want. Ecto will only return a result if we are explicit in
our querying about which result we want.</p><p>If there is no record which matches the query, <code class="inline">one</code> will return <code class="inline">nil</code>.</p><h3 id="fetching-all-records" class="section-heading"><a href="#fetching-all-records" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fetching all records</span></h3><p>To fetch all records from the schema, Ecto provides the <code class="inline">all</code> function:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><p>This will return a <code class="inline">Friends.Person</code> struct representation of all the records that currently exist within our <code class="inline">people</code> table:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="4009915910-1">[</span><span class="p" data-group-id="4009915910-2">%</span><span class="nc" data-group-id="4009915910-2">Friends.Person</span><span class="p" data-group-id="4009915910-2">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4009915910-3">#</span><span class="nc" data-group-id="4009915910-3">Ecto.Schema.Metadata</span><span class="p" data-group-id="4009915910-3"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="4009915910-3">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">28</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p" data-group-id="4009915910-2">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4009915910-4">%</span><span class="nc" data-group-id="4009915910-4">Friends.Person</span><span class="p" data-group-id="4009915910-4">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4009915910-5">#</span><span class="nc" data-group-id="4009915910-5">Ecto.Schema.Metadata</span><span class="p" data-group-id="4009915910-5"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="4009915910-5">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">27</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"John"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">2</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="4009915910-4">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="4009915910-6">%</span><span class="nc" data-group-id="4009915910-6">Friends.Person</span><span class="p" data-group-id="4009915910-6">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="4009915910-7">#</span><span class="nc" data-group-id="4009915910-7">Ecto.Schema.Metadata</span><span class="p" data-group-id="4009915910-7"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="4009915910-7">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">26</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Jane"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">3</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="4009915910-6">}</span><span class="p" data-group-id="4009915910-1">]</span></code></pre><h3 id="fetch-a-single-record-based-on-id" class="section-heading"><a href="#fetch-a-single-record-based-on-id" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fetch a single record based on ID</span></h3><p>To fetch a record based on its ID, you use the <code class="inline">get</code> function:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="9240043422-1">(</span><span class="mi">1</span><span class="p" data-group-id="9240043422-1">)</span><span class="w"></span><span class="c1">#=> %Friends.Person{__meta__: #Ecto.Schema.Metadata<:loaded, "people">, age: 28,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="err">}</span></code></pre><h3 id="fetch-a-single-record-based-on-a-specific-attribute" class="section-heading"><a href="#fetch-a-single-record-based-on-a-specific-attribute" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Fetch a single record based on a specific attribute</span></h3><p>If we want to get a record based on something other than the <code class="inline">id</code> attribute, we can use <code class="inline">get_by</code>:</p><pre><code class="makeup elixir" translate="no"><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">get_by</span><span class="p" data-group-id="0430654375-1">(</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p" data-group-id="0430654375-1">)</span><span class="w"></span><span class="c1">#=> %Friends.Person{__meta__: #Ecto.Schema.Metadata<:loaded, "people">, age: 28,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="err">}</span></code></pre><h3 id="filtering-results" class="section-heading"><a href="#filtering-results" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Filtering results</span></h3><p>If we want to get multiple records matching a specific attribute, we can use <code class="inline">where</code>:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">where</span><span class="p" data-group-id="2053929273-1">(</span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="2053929273-1">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="3224008005-1">[</span><span class="p" data-group-id="3224008005-2">%</span><span class="nc" data-group-id="3224008005-2">Friends.Person</span><span class="p" data-group-id="3224008005-2">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="3224008005-3">#</span><span class="nc" data-group-id="3224008005-3">Ecto.Schema.Metadata</span><span class="p" data-group-id="3224008005-3"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="3224008005-3">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">27</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"John"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">2</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="3224008005-2">}</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="3224008005-4">%</span><span class="nc" data-group-id="3224008005-4">Friends.Person</span><span class="p" data-group-id="3224008005-4">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="3224008005-5">#</span><span class="nc" data-group-id="3224008005-5">Ecto.Schema.Metadata</span><span class="p" data-group-id="3224008005-5"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="3224008005-5">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">26</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Jane"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">3</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="3224008005-4">}</span><span class="p" data-group-id="3224008005-1">]</span></code></pre><p>If we leave off the <code class="inline">Friends.Repo.all</code> on the end of this, we will see the query Ecto generates:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="4657734901-1">#</span><span class="nc" data-group-id="4657734901-1">Ecto.Query</span><span class="p" data-group-id="4657734901-1"><</span><span class="n">from</span><span class="w"></span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">where</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">last_name</span><span class="w"></span><span class="o">==</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="4657734901-1">></span></code></pre><p>We can also use this query syntax to fetch these same records:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">from</span><span class="p" data-group-id="4814318345-1">(</span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">where</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">last_name</span><span class="w"></span><span class="o">==</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="4814318345-1">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><p>One important thing to note with both query syntaxes is that they require variables to be pinned, using the pin operator (<code class="inline">^</code>). Otherwise, this happens:</p><pre><code class="makeup elixir" translate="no"><span class="n">last_name</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="s">"Smith"</span><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">where</span><span class="p" data-group-id="9537304098-1">(</span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="n">last_name</span><span class="p" data-group-id="9537304098-1">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="gt">** (Ecto.Query.CompileError) unbound variable `last_name` in query. If you are attempting to interpolate a value, use ^var
    (ecto)   expanding macro: Ecto.Query.where/2
             iex:15: (file)
    (elixir) expanding macro: Kernel.|>/2
             iex:15: (file)</span></code></pre><p>The same will happen in the longer query syntax too:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">from</span><span class="p" data-group-id="7500557879-1">(</span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">where</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">last_name</span><span class="w"></span><span class="o">==</span><span class="w"></span><span class="n">last_name</span><span class="p" data-group-id="7500557879-1">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="gt">** (Ecto.Query.CompileError) unbound variable `last_name` in query. If you are attempting to interpolate a value, use ^var
    (ecto)   expanding macro: Ecto.Query.where/3
             iex:15: (file)
    (ecto)   expanding macro: Ecto.Query.from/2
             iex:15: (file)
    (elixir) expanding macro: Kernel.|>/2
             iex:15: (file)</span></code></pre><p>To get around this, we use the pin operator (<code class="inline">^</code>):</p><pre><code class="makeup elixir" translate="no"><span class="n">last_name</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="s">"Smith"</span><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">where</span><span class="p" data-group-id="0681006748-1">(</span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="o">^</span><span class="n">last_name</span><span class="p" data-group-id="0681006748-1">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><p>Or:</p><pre><code class="makeup elixir" translate="no"><span class="n">last_name</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="s">"Smith"</span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">from</span><span class="p" data-group-id="0437239846-1">(</span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">where</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">last_name</span><span class="w"></span><span class="o">==</span><span class="w"></span><span class="o">^</span><span class="n">last_name</span><span class="p" data-group-id="0437239846-1">)</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">all</span></code></pre><p>The pin operator instructs the query builder to use parameterized SQL queries protecting against SQL injection.</p><h3 id="composing-ecto-queries" class="section-heading"><a href="#composing-ecto-queries" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Composing Ecto queries</span></h3><p>Ecto queries don't have to be built in one spot. They can be built up by calling <a href="Ecto.Query.html"><code class="inline">Ecto.Query</code></a> functions on existing queries. For instance, if we want to find all people with the last name "Smith", we can do:</p><pre><code class="makeup elixir" translate="no"><span class="n">query</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">where</span><span class="p" data-group-id="7824768444-1">(</span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Smith"</span><span class="p" data-group-id="7824768444-1">)</span></code></pre><p>If we want to scope this down further to only people with the first name of "Jane", we can do this:</p><pre><code class="makeup elixir" translate="no"><span class="n">query</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="n">query</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">where</span><span class="p" data-group-id="0792844208-1">(</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Jane"</span><span class="p" data-group-id="0792844208-1">)</span></code></pre><p>Our query will now have two <code class="inline">where</code> clauses in it:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="7746750239-1">#</span><span class="nc" data-group-id="7746750239-1">Ecto.Query</span><span class="p" data-group-id="7746750239-1"><</span><span class="n">from</span><span class="w"></span><span class="n">p</span><span class="w"></span><span class="ow">in</span><span class="w"></span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="ss">where</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">last_name</span><span class="w"></span><span class="o">==</span><span class="w"></span><span class="s">"Smith"</span><span class="p">,</span><span class="w"></span><span class="ss">where</span><span class="p">:</span><span class="w"></span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span><span class="w"></span><span class="o">==</span><span class="w"></span><span class="s">"Jane"</span><span class="p" data-group-id="7746750239-1">></span></code></pre><p>This can be useful if you want to do something with the first query, and then build off that query later on.</p><h2 id="updating-records" class="section-heading"><a href="#updating-records" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Updating records</span></h2><p>Updating records in Ecto requires us to first fetch a record from the database. We then create a changeset from that record and the changes we want to make to that record, and then call the <code class="inline">Ecto.Repo.update</code> function.</p><p>Let's fetch the first person from our database and change their age. First, we'll fetch the person:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Ecto.Query</span><span class="o">.</span><span class="n">first</span><span class="w"></span><span class="o">|></span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">one</span></code></pre><p>Next, we'll build a changeset. We need to build a changeset because if we just create a new <code class="inline">Friends.Person</code> struct with the new age, Ecto wouldn't be able to know that the age has changed without inspecting the database. Let's build that changeset:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="3823792562-1">(</span><span class="n">person</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="3823792562-2">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">29</span><span class="p" data-group-id="3823792562-2">}</span><span class="p" data-group-id="3823792562-1">)</span></code></pre><p>This changeset will inform the database that we want to update the record to have the <code class="inline">age</code> set to 29. To tell the database about the change we want to make, we run this command:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="4842794289-1">(</span><span class="n">changeset</span><span class="p" data-group-id="4842794289-1">)</span></code></pre><p>Just like <code class="inline">Friends.Repo.insert</code>, <code class="inline">Friends.Repo.update</code> will return a tuple:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="6357987222-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="6357987222-2">%</span><span class="nc" data-group-id="6357987222-2">Friends.Person</span><span class="p" data-group-id="6357987222-2">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="6357987222-3">#</span><span class="nc" data-group-id="6357987222-3">Ecto.Schema.Metadata</span><span class="p" data-group-id="6357987222-3"><</span><span class="ss">:loaded</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="6357987222-3">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">29</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">1</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p" data-group-id="6357987222-2">}</span><span class="p" data-group-id="6357987222-1">}</span></code></pre><p>If the changeset fails for any reason, the result of <code class="inline">Friends.Repo.update</code> will be <code class="inline">{:error, changeset}</code>. We can see this in action by passing through a blank <code class="inline">first_name</code> in our changeset's parameters:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="1424818697-1">(</span><span class="n">person</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="1424818697-2">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">""</span><span class="p" data-group-id="1424818697-2">}</span><span class="p" data-group-id="1424818697-1">)</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="1424818697-3">(</span><span class="n">changeset</span><span class="p" data-group-id="1424818697-3">)</span><span class="w"></span><span class="c1">#=> {:error,</span><span class="w"></span><span class="p" data-group-id="1424818697-4">#</span><span class="nc" data-group-id="1424818697-4">Ecto.Changeset</span><span class="p" data-group-id="1424818697-4"><</span><span class="w"></span><span class="ss">action</span><span class="p">:</span><span class="w"></span><span class="ss">:update</span><span class="p">,</span><span class="w"></span><span class="ss">changes</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="1424818697-5">%{</span><span class="p" data-group-id="1424818697-5">}</span><span class="p">,</span><span class="w"></span><span class="ss">errors</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="1424818697-6">[</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="1424818697-7">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="1424818697-8">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="1424818697-8">]</span><span class="p" data-group-id="1424818697-7">}</span><span class="p" data-group-id="1424818697-6">]</span><span class="p">,</span><span class="w"></span><span class="ss">data</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="1424818697-9">#</span><span class="nc" data-group-id="1424818697-9">Friends.Person</span><span class="p" data-group-id="1424818697-9"><</span><span class="p" data-group-id="1424818697-9">></span><span class="p">,</span><span class="w"></span><span class="ss">valid?</span><span class="p">:</span><span class="w"></span><span class="no">false</span><span class="w"></span><span class="p" data-group-id="1424818697-4">></span><span class="err">}</span></code></pre><p>This means that you can also use a <code class="inline">case</code> statement to do different things depending on the outcome of the <code class="inline">update</code> function:</p><pre><code class="makeup elixir" translate="no"><span class="k">case</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="2663488095-1">(</span><span class="n">changeset</span><span class="p" data-group-id="2663488095-1">)</span><span class="w"></span><span class="k" data-group-id="2663488095-2">do</span><span class="w"></span><span class="p" data-group-id="2663488095-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"></span><span class="n">person</span><span class="p" data-group-id="2663488095-3">}</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="c1"># do something with person</span><span class="w"></span><span class="p" data-group-id="2663488095-4">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"></span><span class="n">changeset</span><span class="p" data-group-id="2663488095-4">}</span><span class="w"></span><span class="o">-></span><span class="w"></span><span class="c1"># do something with changeset</span><span class="w"></span><span class="k" data-group-id="2663488095-2">end</span></code></pre><p>Similar to <code class="inline">insert!</code>, there is also <code class="inline">update!</code> which will raise an exception if the changeset is invalid:</p><pre><code class="makeup elixir" translate="no"><span class="n">changeset</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Person</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="6169148904-1">(</span><span class="n">person</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="6169148904-2">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">""</span><span class="p" data-group-id="6169148904-2">}</span><span class="p" data-group-id="6169148904-1">)</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">update!</span><span class="w"></span><span class="n">changeset</span><span class="w"></span><span class="gt">** (Ecto.InvalidChangesetError) could not perform update because changeset is invalid.</span><span class="w"></span><span class="nc">Errors</span><span class="w"></span><span class="p" data-group-id="6169148904-3">%{</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="6169148904-4">[</span><span class="p" data-group-id="6169148904-5">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="6169148904-6">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="6169148904-6">]</span><span class="p" data-group-id="6169148904-5">}</span><span class="p" data-group-id="6169148904-4">]</span><span class="p" data-group-id="6169148904-3">}</span><span class="w"></span><span class="nc">Applied</span><span class="w"></span><span class="n">changes</span><span class="w"></span><span class="p" data-group-id="6169148904-7">%{</span><span class="p" data-group-id="6169148904-7">}</span><span class="w"></span><span class="nc">Params</span><span class="w"></span><span class="p" data-group-id="6169148904-8">%{</span><span class="s">"first_name"</span><span class="w"></span><span class="p">=></span><span class="w"></span><span class="s">""</span><span class="p" data-group-id="6169148904-8">}</span><span class="w"></span><span class="nc">Changeset</span><span class="w"></span><span class="p" data-group-id="6169148904-9">#</span><span class="nc" data-group-id="6169148904-9">Ecto.Changeset</span><span class="p" data-group-id="6169148904-9"><</span><span class="w"></span><span class="ss">action</span><span class="p">:</span><span class="w"></span><span class="ss">:update</span><span class="p">,</span><span class="w"></span><span class="ss">changes</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="6169148904-10">%{</span><span class="p" data-group-id="6169148904-10">}</span><span class="p">,</span><span class="w"></span><span class="ss">errors</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="6169148904-11">[</span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="6169148904-12">{</span><span class="s">"can't be blank"</span><span class="p">,</span><span class="w"></span><span class="p" data-group-id="6169148904-13">[</span><span class="ss">validation</span><span class="p">:</span><span class="w"></span><span class="ss">:required</span><span class="p" data-group-id="6169148904-13">]</span><span class="p" data-group-id="6169148904-12">}</span><span class="p" data-group-id="6169148904-11">]</span><span class="p">,</span><span class="w"></span><span class="ss">data</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="6169148904-14">#</span><span class="nc" data-group-id="6169148904-14">Friends.Person</span><span class="p" data-group-id="6169148904-14"><</span><span class="p" data-group-id="6169148904-14">></span><span class="p">,</span><span class="w"></span><span class="ss">valid?</span><span class="p">:</span><span class="w"></span><span class="no">false</span><span class="w"></span><span class="p" data-group-id="6169148904-9">></span><span class="w"></span><span class="p" data-group-id="6169148904-15">(</span><span class="n">ecto</span><span class="p" data-group-id="6169148904-15">)</span><span class="w"></span><span class="n">lib</span><span class="o">/</span><span class="n">ecto</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">ex</span><span class="p">:</span><span class="mi">270</span><span class="p">:</span><span class="w"></span><span class="nc">Ecto.Repo.Schema</span><span class="o">.</span><span class="n">update!</span><span class="o">/</span><span class="mi">4</span></code></pre><h2 id="deleting-records" class="section-heading"><a href="#deleting-records" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Deleting records</span></h2><p>We've now covered creating (<code class="inline">insert</code>), reading (<code class="inline">get</code>, <code class="inline">get_by</code>, <code class="inline">where</code>) and updating records. The last thing that we'll cover in this guide is how to delete a record using Ecto.</p><p>Similar to updating, we must first fetch a record from the database and then call <code class="inline">Friends.Repo.delete</code> to delete that record:</p><pre><code class="makeup elixir" translate="no"><span class="n">person</span><span class="w"></span><span class="o">=</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="3542335826-1">(</span><span class="nc">Friends.Person</span><span class="p">,</span><span class="w"></span><span class="mi">1</span><span class="p" data-group-id="3542335826-1">)</span><span class="w"></span><span class="nc">Friends.Repo</span><span class="o">.</span><span class="n">delete</span><span class="p" data-group-id="3542335826-2">(</span><span class="n">person</span><span class="p" data-group-id="3542335826-2">)</span><span class="w"></span><span class="c1">#=> {:ok,</span><span class="w"></span><span class="p" data-group-id="3542335826-3">%</span><span class="nc" data-group-id="3542335826-3">Friends.Person</span><span class="p" data-group-id="3542335826-3">{</span><span class="ss">__meta__</span><span class="p">:</span><span class="w"></span><span class="p" data-group-id="3542335826-4">#</span><span class="nc" data-group-id="3542335826-4">Ecto.Schema.Metadata</span><span class="p" data-group-id="3542335826-4"><</span><span class="ss">:deleted</span><span class="p">,</span><span class="w"></span><span class="s">"people"</span><span class="p" data-group-id="3542335826-4">></span><span class="p">,</span><span class="w"></span><span class="ss">age</span><span class="p">:</span><span class="w"></span><span class="mi">29</span><span class="p">,</span><span class="w"></span><span class="ss">first_name</span><span class="p">:</span><span class="w"></span><span class="s">"Ryan"</span><span class="p">,</span><span class="w"></span><span class="ss">id</span><span class="p">:</span><span class="w"></span><span class="mi">2</span><span class="p">,</span><span class="w"></span><span class="ss">last_name</span><span class="p">:</span><span class="w"></span><span class="s">"Bigg"</span><span class="p" data-group-id="3542335826-3">}</span><span class="err">}</span></code></pre><p>Similar to <code class="inline">insert</code> and <code class="inline">update</code>, <code class="inline">delete</code> returns a tuple. If the deletion succeeds, then the first element in the tuple will be <code class="inline">:ok</code>, but if it fails then it will be an <code class="inline">:error</code>.</p></div><div class="bottom-actions" id="bottom-actions"><div class="bottom-actions-item"><a href="changelog.html" class="bottom-actions-button" rel="prev"><span class="subheader">
          ← Previous Page
        </span><span class="title">
Changelog for v3.x
        </span></a></div><div class="bottom-actions-item"><a href="embedded-schemas.html" class="bottom-actions-button" rel="next"><span class="subheader">
          Next Page →
        </span><span class="title">
Embedded Schemas
        </span></a></div></div><footer class="footer"><p><span class="line"><a href="https://hex.pm/packages/ecto/3.12.4" class="footer-hex-package">Hex Package</a><a href="https://preview.hex.pm/preview/ecto/3.12.4">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/ecto/3.12.4/show/guides/introduction/Getting Started.md">current file</a>)

          </span><span class="line"><a href="Ecto.epub" title="ePub version">
              Download ePub version
            </a></span></p><p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a></p></footer></div></main></div><script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.3/dist/mermaid.min.js"></script><script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({
      startOnLoad: false,
      theme: document.body.className.includes("dark") ? "dark" : "default"
    });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
        graphEl.innerHTML = svg;
        bindFunctions?.(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script></body></html>